drop table tickets;
drop table rides;
drop table stops;
drop table connections;
drop table users;
drop table stations;


alter table users modify PASSWORD VARCHAR2(200 BYTE);
-- tabela stacje
  CREATE TABLE "Z13"."STATIONS" 
   (	"STATION_ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"NAME" VARCHAR2(40 BYTE) NOT NULL ENABLE, 
	 CONSTRAINT "STATIONS_PK" PRIMARY KEY ("STATION_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "II_DATA"  ENABLE
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 ROW STORE COMPRESS ADVANCED LOGGING
  TABLESPACE "II_DATA" ;
  
  alter table "Z13"."STATIONS" rename column "connection_station" to connection_station;

--tabela uzytkownicy

  CREATE TABLE "Z13"."USERS" 
   (	"USER_ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"LOGIN" VARCHAR2(40 BYTE) NOT NULL ENABLE, 
	"PASSWORD" VARCHAR2(40 BYTE) NOT NULL ENABLE, 
	"NAME" VARCHAR2(40 BYTE) NOT NULL ENABLE, 
	"SURNAME" VARCHAR2(40 BYTE) NOT NULL ENABLE, 
	 CONSTRAINT "USERS_PK" PRIMARY KEY ("USER_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "II_DATA"  ENABLE, 
	 UNIQUE ("LOGIN")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "II_DATA"  ENABLE
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 ROW STORE COMPRESS ADVANCED LOGGING
  TABLESPACE "II_DATA" ;
  
  


--tabela connections
  CREATE TABLE "Z13"."CONNECTIONS" 
   (	"CONNECTION_ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"DEPARTURE_STATION" NUMBER NOT NULL ENABLE, 
	"ARRIVAL_STATION" NUMBER NOT NULL ENABLE, 
	 CONSTRAINT "CONNECTION_PK" PRIMARY KEY ("CONNECTION_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "II_DATA"  ENABLE, 
	 CONSTRAINT "FK_DEP" FOREIGN KEY ("DEPARTURE_STATION")
	  REFERENCES "Z13"."STATIONS" ("STATION_ID") ENABLE, 
	 CONSTRAINT "FK_ARR" FOREIGN KEY ("ARRIVAL_STATION")
	  REFERENCES "Z13"."STATIONS" ("STATION_ID") ENABLE
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 ROW STORE COMPRESS ADVANCED LOGGING
  TABLESPACE "II_DATA" ;
  
--tabela przystanki
CREATE TABLE "Z13"."STOPS" 
   (	"CONNECTION_ID" NUMBER NOT NULL ENABLE, 
	"STATION_ID" NUMBER NOT NULL ENABLE, 
	"ARRIVAL_HOUR" TIMESTAMP NOT NULL ENABLE, 
	"DEPARTURE_HOUR" TIMESTAMP NOT NULL ENABLE, 
	 CONSTRAINT "PK" PRIMARY KEY ("CONNECTION_ID", "STATION_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "II_DATA"  ENABLE, 
	 CONSTRAINT "FK_CON" FOREIGN KEY ("CONNECTION_ID")
	  REFERENCES "Z13"."CONNECTIONS" ("CONNECTION_ID") ENABLE, 
	 CONSTRAINT "FK_STAT" FOREIGN KEY ("STATION_ID")
	  REFERENCES "Z13"."STATIONS" ("STATION_ID") ENABLE
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 ROW STORE COMPRESS ADVANCED LOGGING
  TABLESPACE "II_DATA" ;
  

--tabela przejazdy
  CREATE TABLE "Z13"."RIDES" 
   (	"RIDE_ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"CONNECTION_ID" NUMBER NOT NULL ENABLE, 
	"RIDE_DATE" DATE NOT NULL ENABLE, 
	 CONSTRAINT "RIDE_PK" PRIMARY KEY ("RIDE_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "II_DATA"  ENABLE, 
	 CONSTRAINT "FK_CONN" FOREIGN KEY ("CONNECTION_ID")
	  REFERENCES "Z13"."CONNECTIONS" ("CONNECTION_ID") ENABLE
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 ROW STORE COMPRESS ADVANCED LOGGING
  TABLESPACE "II_DATA" ;
  
--tabela bilety
CREATE TABLE "Z13"."TICKETS" 
   (	"TICKET_ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"CONNECTION_ID" NUMBER,
    "DATE" DATE NOT NULL ENABLE,
    "ID_DEPARTURE_STATION" NUMBER NOT NULL ENABLE, 
	"ID_ARRIVAL_STATION" NUMBER NOT NULL ENABLE, 
	"USER_ID" NUMBER NOT NULL ENABLE, 
    "DISCOUNT_ID" NUMBER,
    "CAR_ID" NUMBER,
    "SEAT_ID" NUMBER,
    "PRICE" NUMBER,
	 CONSTRAINT "TICKET_PK" PRIMARY KEY ("TICKET_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "II_DATA"  ENABLE, 
     CONSTRAINT "FK_CONNECTION_ID" FOREIGN KEY ("CONNECTION_ID")
      REFERENCES "Z13"."CONNECTIONS" ("CONNECTION_ID") ENABLE, 
     CONSTRAINT "FK_DISCOUNT_ID" FOREIGN KEY ("DISCOUNT_ID")
      REFERENCES "Z13"."DISCOUNTS" ("ID") ENABLE, 
	 CONSTRAINT "FK_DEP_TICKET" FOREIGN KEY ("ID_DEPARTURE_STATION")
	  REFERENCES "Z13"."STATIONS" ("STATION_ID") ENABLE, 
	 CONSTRAINT "FK_ARR_TICKET" FOREIGN KEY ("ID_ARRIVAL_STATION")
	  REFERENCES "Z13"."STATIONS" ("STATION_ID") ENABLE, 
	 CONSTRAINT "FK_USER_TICKET" FOREIGN KEY ("USER_ID")
	  REFERENCES "Z13"."USERS" ("USER_ID") ENABLE
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 ROW STORE COMPRESS ADVANCED LOGGING
  TABLESPACE "II_DATA" ;

  create table sits
(
    sit_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE,
    ride_id number not null,
    car_number number not null,
    sit_number number not null,
    ticket_id number,
    
    constraint r_id foreign key (ride_id) references rides (ride_id),
    constraint t_id foreign key (ticket_id) references tickets (ticket_id)
    
);

alter table users
    add email varchar2(40)

commit;




SELECT O.OBJECT_NAME, S.SID, S.SERIAL#, P.SPID, S.PROGRAM,S.USERNAME,
S.MACHINE,S.PORT , S.LOGON_TIME,SQ.SQL_FULLTEXT 
FROM V$LOCKED_OBJECT L, DBA_OBJECTS O, V$SESSION S, 
V$PROCESS P, V$SQL SQ 
WHERE L.OBJECT_ID = O.OBJECT_ID 
AND L.SESSION_ID = S.SID AND S.PADDR = P.ADDR 
AND S.SQL_ADDRESS = SQ.ADDRESS;

alter system kill session '376,6791';